# Springboot application integration with Oracle Database 19c
A demo application with Springboot and Oracle DB using Oracle UCP as Connection Pool.

# Getting Started

Ensure you have an Oracle 19c DB instance up running before you run the Springboot application. If you prefer running a docker image locally of the Oracle Database, refer to the 'Setting up Oracle DB using Docker image' section below. 

Ensure the spring.profiles.active property in application.properties is set to 'dev' (if its 'local', then it will run an in-memory H2 DB). This will load the configuration in application-dev.properties, which has details to connect to the Oracle Database. 

Ensure you provide the right username and password for the DB connection. And that there is a table, based on the Java model, present in the DB. Refer to the end of this document for the DB schema.

Start the spring applicaiton by entering the root directory (/springboot-oracle) and running the following command:
```
mvn spring-boot:run
```

The API is running on http://localhost:8080/data-app/individuals

Setting up Oracle DB using Docker image
----------------

1. Clone `https://github.com/oracle/docker-images`.
1. Download the Oracle Database 19c binary `LINUX.X64_193000_db_home.zip` from http://www.oracle.com/technetwork/database/enterprise-edition/downloads/index.html
1. Put the zip in the `OracleDatabase/SingleInstance/dockerfiles/19.3.0` directory. **Do not unzip it.**
1. In Docker Desktop, ensure you have a large enough amount of memory allocated. These instructions will set the total memory to 4000MB, so make sure Docker has a value higher than that. Remove unwanted or unused images. User `docker image prune` to remove old unused images.

Building
--------


````
cd OracleDatabase/SingleInstance/dockerfiles
./buildContainerImage.sh -v 19.3.0 -e
````

Running the docker image
-------

To use the sensible defaults:

```
docker run \
--name oracle19c \
-p 1521:1521 \
-p 5500:5500 \
-e ORACLE_PDB=orcl \
-e ORACLE_PWD=password \
-e INIT_SGA_SIZE=3000 \
-e INIT_PGA_SIZE=1000 \
-v /opt/oracle/oradata \
-d \
oracle/database:19.3.0-ee

```
On first run, the database will be created and setup for you. This will take about 10-15 minutes. Open Docker Dashboard and watch the progress. Then you can connect.

Executing shell commands on this container
-------

First get hold of the docker container id by running the following command
```
docker ps | grep oracle19c
```
Then execute the following commands (using the container id from the above command) to enter the shell and to connect to the Database.
```
docker exec -it <container id> /bin/bash
bash-4.2$ sqlplus sys/password@//localhost:1521/orcl as sysdba
```

You should now be connected to the Oracle Database. You can now create a user using the following command. This is the username and password that you configure in your Springboot app (in the application.properties file).

```
SQL> CREATE USER SPRINGORCL IDENTIFIED BY springorclpwd;
```
After the user is created, grant privelages to it using the following command

```
GRANT CONNECT, RESOURCE, DBA TO SPRINGORCL;
```
And then connect to the Database using the user with the following command.

```
SQL> CONNECT SPRINGORCL@orcl;
```
Create the table that your Springboot app needs to connect to.

```
CREATE TABLE Person (
  id INTEGER GENERATED BY DEFAULT AS IDENTITY NOT NULL,
   first_name VARCHAR2(255) NOT NULL,
   last_name VARCHAR2(255) NOT NULL,
   birth_date date NOT NULL,
   CONSTRAINT pk_person PRIMARY KEY (id)
);
```
